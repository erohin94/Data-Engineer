# **–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î postgreSQL**

–°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ postgreSQL. –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ HH API –≤ –≤–∏–¥–µ JSON –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ `.csv` —Ñ–∞–π–ª –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –≤–∏–¥–µ –∏ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω–æ–º.

–í —Ñ–∞–π–ª–µ `main_test.py` –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

–í —Ñ–∞–π–ª–µ `create_table.py` –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤ `main_test.py` —Ü–∏–∫–ª–æ–º.

–í —Ñ–∞–π–ª–µ `insert_in_postgresql.py` –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ `sql_query_execute()` –∏ –≤—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î `insert_into_hadoop()`.

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤ –ë–î –ø–æ—è–≤–ª—è—é—Ç—Å—è –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã

![image](https://github.com/user-attachments/assets/af58896a-3dbb-48d0-9f7c-6007c978a2f6)

**–ó–∞–º–µ—Ç–∫–∏:**

–í–∞–∂–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ–±–ª—é–¥–∞—Ç—å —Ç–∏–ø—ã –∫–æ–ª–æ–Ω–æ–∫ –≤ –ë–î –∏ —Ç–∏–ø—ã –∫–æ–ª–æ–Ω–æ–∫ –≤ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–µ –∫–æ—Ç–æ—Ä—ã–π –≥—Ä—É–∑–∏–º, –∏–Ω–∞—á–µ –±—É–¥—É—Ç –æ—à–∏–±–∫–∏.

–°–æ–±–ª—é–¥–∞—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤, —Ä–∞–∑–Ω—ã–µ –ë–î –≤–µ–¥—É—Ç —Å–µ–±—è –ø–æ —Ä–∞–∑–Ω–æ–º—É.

–ü—Ä–∏–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ DataFrame –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Ç–∏–ø–∞–º Python. –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ `execute_values`, –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–∏–ø—ã Python, —Ç–∞–∫–∏–µ –∫–∞–∫ `int`, `float`, `str`, `datetime`, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è psycopg2. 

–ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—à—å DataFrame, pandas –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `NumPy` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –ò —á—Ç–æ–±—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ –º–∞—Å—Å–∏–≤—ã —á–∏—Å–µ–ª, –æ–Ω –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–∏–ø—ã –≤—Ä–æ–¥–µ `np.float64`, `np.int64`, `np.object_` –∏ —Ç.–ø. ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ NumPy-–∞–Ω–∞–ª–æ–≥ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ Python (`float`, `int` –∏ —Ç.–¥.), –Ω–æ —Å –±–æ–ª—å—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `sqlite3`, `psycopg2`, `sqlalchemy`) –Ω–µ –≤—Å–µ–≥–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–æ–¥—è—Ç `np.float64` –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É `float`, –∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞.

–°–¥–µ–ª–∞–ª —Å –ø–æ–º–æ—â—å—é `df = df.astype(object)` –ø–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î.

–î–∞—Ç–∞ —Ñ—Ä–µ–π–º –Ω–∞–¥–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤–∏–¥—É, —Ç–æ–µ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏ –∏ —Å—Ç—Ä–æ–∫–∏ —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:

```
INSERT INTO users (id, name, email) VALUES (2, '–ü—ë—Ç—Ä –°–º–∏—Ä–Ω–æ–≤', 'petr@example.com'), (3, '–û–ª—å–≥–∞ –°–æ–∫–æ–ª–æ–≤–∞', 'olga@example.com');
```

# **–û—Ç–ª–∏—á–∏–µ –≤—Å—Ç–∞–≤–∫–∏ —á–µ—Ä–µ–∑:**

```
insert_str = f"INSERT INTO {insert_table} ({t_columns}) VALUES %s"
```

–∏
```
insert_str = f"insert into {'insert_table'} ({t_columns}) values{t_values}"
```

‚úÖ –ü–µ—Ä–≤—ã–π —Å–ø–æ—Å–æ–± (—á–µ—Ä–µ–∑ %s):
```
insert_str = f"INSERT INTO {insert_table} ({t_columns}) VALUES %s"
```

–≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –Ω–µ –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∞–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é –≤ —Å—Ç—Ä–æ–∫—É ‚Äî –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å –º–µ—Ç–æ–¥–æ–º execute_values() –∏–∑ psycopg2.extras (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤), –∫–æ—Ç–æ—Ä—ã–π –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è.

–ü—Ä–∏–º–µ—Ä:
```
from psycopg2.extras import execute_values

insert_str = f"INSERT INTO {insert_table} ({t_columns}) VALUES %s"
execute_values(cursor, insert_str, t_values)
```

‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

-–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –∑–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π.

-–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –≤—Å—Ç–∞–≤–∫–∞ —Å—Ä–∞–∑—É –º–Ω–æ–≥–∏—Ö —Å—Ç—Ä–æ–∫ (bulk insert).

-–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —ç–∫—Ä–∞–Ω–∏–∑–∞—Ü–∏—è: —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã, –∫–∞–≤—ã—á–∫–∏, –¥–∞—Ç—ã –∏ —Ç.–¥.

üö´ –í—Ç–æ—Ä–æ–π —Å–ø–æ—Å–æ–± (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π, –≤—Ä—É—á–Ω—É—é –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è):

```
insert_str = f"INSERT INTO {'insert_table'} ({t_columns}) VALUES{t_values}"
```

–ó–¥–µ—Å—å t_values ‚Äî —ç—Ç–æ —É–∂–µ –≤—Ä—É—á–Ω—É—é —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
t_values = "(1, 'Alice'), (2, 'Bob')"
```

‚ùó –ú–∏–Ω—É—Å—ã:

-–£—è–∑–≤–∏–º–æ—Å—Ç—å –∫ SQL-–∏–Ω—ä–µ–∫—Ü–∏—è–º, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –æ—Ç–∫—É–¥–∞-—Ç–æ –∏–∑–≤–Ω–µ.

-–°–ª–æ–∂–Ω–æ—Å—Ç—å —Å –∫–∞–≤—ã—á–∫–∞–º–∏, –¥–∞—Ç–∞–º–∏, —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

-–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–∏–ø–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, None ‚Üí NULL).

-–ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å execute_values() –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ ‚Äî —ç—Ç–æ —É–∂–µ "—Å–æ–±—Ä–∞–Ω–Ω–∞—è" SQL-—Å—Ç—Ä–æ–∫–∞.


**SQL –∑–∞–ø—Ä–æ—Å—ã**

```
DROP TABLE IF EXISTS sbxm_hr.rda_hh_application_resume_erohin

DROP TABLE IF EXISTS sbxm_hr.rda_hh_full_resume_erohin

select * from sbxm_hr.rda_hh_application_resume_erohin 

select * from sbxm_hr.rda_hh_full_resume_erohin
```



