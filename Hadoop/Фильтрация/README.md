У меня есть таблицца t1

```
pid | position_nm                         | department_parent_lv1_nm                 | department_nm
----+-------------------------------------+------------------------------------------+---------------------------------
1   | главный специалист                  | NULL                                     | Департамент мониторинга корпоративных клиентов
2   | исполнительный директор             | Департамент розничного андеррайтинга     | Управление экспертизы
3   | начальник Департамента              | Департамент розничного андеррайтинга     | Управление андеррайтинга
4   | заместитель начальника Департамента | NULL                                     | Департамент розничного андеррайтинга
5   | главный специалист                  | Департамент управления данных            | NULL
```

И два запроса с разным приоритетом в фильтре WHERE

```
SELECT pid, position_nm, department_parent_lv1_nm, department_nm
FROM t1
WHERE 1 = 1
and position_nm NOT IN ('Вице-Президент - начальник Департамента',
﻿﻿		                    'заместитель начальника Департамента',
                        '﻿﻿начальник Департамента',
                        '﻿﻿заместитель начальника Управления',
                        ﻿﻿'заместитель начальника Управления-исполнительный директор',
                        'начальник Управления'
                        '﻿﻿секретарь')

and department_parent_lv1_nm IN ('Департамент корпоративного андеррайтинга',
                                 '﻿﻿Департамент мониторинга корпоративных клиентов',
                                 '﻿﻿Департамент розничного андеррайтинга')

or department_nm IN ('Департамент корпоративного андеррайтинга',
                                  '﻿﻿Департамент мониторинга корпоративных клиентов',
                                  '﻿﻿Департамент розничного андеррайтинга')
```

и другой запрос

```
SELECT pid, position_nm, department_parent_lv1_nm, department_nm
FROM t1
WHERE 1 = 1
and position_nm NOT IN ('Вице-Президент - начальник Департамента',
﻿﻿		                    'заместитель начальника Департамента',
                        '﻿﻿начальник Департамента',
                        '﻿﻿заместитель начальника Управления',
                        ﻿﻿'заместитель начальника Управления-исполнительный директор',
                        'начальник Управления'
                        '﻿﻿секретарь')

and (
department_parent_lv1_nm IN ('Департамент корпоративного андеррайтинга',
                                 '﻿﻿Департамент мониторинга корпоративных клиентов',
                                 '﻿﻿Департамент розничного андеррайтинга')

or department_nm IN ('Департамент корпоративного андеррайтинга',
                                  '﻿﻿Департамент мониторинга корпоративных клиентов',
                                  '﻿﻿Департамент розничного андеррайтинга')
)
```

**В чем будет различие работы фильтра?**

Различие в работе фильтра между двумя запросами заключается в приоритете логических операторов.

*В SQL оператор `AND` имеет более высокий приоритет, чем `OR`.*

**Первый запрос (без скобок):**

```
WHERE 1 = 1
and position_nm NOT IN (...)
and department_parent_lv1_nm IN (...)
or department_nm IN (...)
```

Фактический порядок выполнения:

```
WHERE (position_nm NOT IN (...) AND department_parent_lv1_nm IN (...))
OR department_nm IN (...)
```
Это означает: записи будут отобраться если:

1.Либо `position_nm` не в черном списке И `department_parent_lv1_nm` в нужном списке

2.Либо просто `department_nm` в нужном списке (при этом ограничения на `position_nm` не применяются)


**Второй запрос (со скобками):**

```
WHERE 1 = 1
and position_nm NOT IN (...)
and (department_parent_lv1_nm IN (...) or department_nm IN (...))
```

Это означает: записи будут отобраться если:

1.`position_nm` не в черном списке И

2.(`department_parent_lv1_nm` в нужном списке ИЛИ `department_nm` в нужном списке)

**Практическая разница:**

В первом запросе могут вернуться записи, где `position_nm` находится в черном списке (например, 'заместитель начальника Департамента'), если при этом `department_nm` попадает в нужный список.

Во втором запросе ограничение на `position_nm` применяется ко всем записям без исключения.

Пример: Запись с `position_nm` = 'заместитель начальника Департамента' и `department_nm` = 'Департамент розничного андеррайтинга':

В первом запросе попадет в результат

Во втором запросе не попадет в результат

**Примеры**

`WHERE A OR B AND C` фактически читается как: `WHERE A OR (B AND C)`

`WHERE (A OR B) AND C` - Теперь сначала выполняется `A OR B`, потом результат `AND C`.
