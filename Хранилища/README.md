## Оглавление

- [Виды баз данных](#виды-баз-данных)
- [Что такое OLAP/OLTP?](#что-такое-olapoltp)
- [Что такое таблица и из каких элементов она состоит?](#что-такое-таблица-и-из-каких-элементов-она-состоит)
- [ACID](#ACID)
- [Ключи](#ключи)

##  Виды баз данных

Внутриуровнево базы данных делятся на виды:

**Реляционные базы данных** организуют данные в виде таблиц, где каждая таблица состоит из строк (записей) и столбцов (полей). Таблицы могут быть связаны между собой через ключи.

**Нереляционные NoSQL(NotOnlySQL) базы данных** предназначены для работы с данными, которые не вписываются в традиционные реляционные модели. 
Они могут хранить данные в виде документов (обычно JSON), ключ-значение пар, графов или столбцов. NoSQL базы данных часто используются для работы с большими объемами данных и в высоконагруженных системах.

**Колоночные базы данных** — это базы данных, в которых данные организуются и хранятся по столбцам, а не по строкам, как в традиционных реляционных базах данных. 
Этот подход обеспечивает высокую эффективность при выполнении аналитических запросов, особенно на больших объемах данных. Пример *ClickHouse*

![image](https://github.com/user-attachments/assets/e2c2c067-cf90-478f-a1fd-e5ab55352a1f)

**Так же есть другие виды баз данных:** Иерархические, Документоориентированные, Графовые, Объектно-ориентированные

## Что такое OLAP/OLTP?

Верхнеуровнево базы данных делятся на OLTP и OLAP.

**OLTP (Online Transaction Processing)** — это тип системы обработки данных, предназначенный для управления транзакциями в режиме реального времени. Эти системы обрабатывают большое количество коротких онлайн-транзакций (например, покупка товаров, внесение платежей, обновление записей и т.д.). OLTP-системы оптимизированы для быстрого выполнения большого количества запросов, таких как вставка, обновление и удаление данных.

**Транзакции** в контексте баз данных — это набор операций, выполняемых как единое целое. 

Транзакция гарантирует, что все операции в её составе будут выполнены полностью и корректно или не будут выполнены вовсе. 

Транзакции обеспечивают целостность данных и помогают избежать ситуаций, когда данные остаются в непоследовательном состоянии из-за сбоев или ошибок. 

**Основные характеристики OLTP:**

OLTP-системы поддерживают большое количество одновременных пользователей и операций.

Данные часто структурированы и нормализованы для уменьшения избыточности и обеспечения целостности данных.

OLTP-системы обеспечивают ACID-свойства (атомарность, согласованность, изолированность, долговечность), что важно для обеспечения точности и надежности транзакций.
Банковские системы, системы управления заказами, системы бронирования билетов, системы управления складом.

Пример: Интернет-магазин, который обрабатывает заказы клиентов в реальном времени, добавляет записи о заказах, обновляет информацию о запасах и обрабатывает платежи.

------------------------------------

**OLAP (Online Analytical Processing)** — это тип системы обработки данных, предназначенный для анализа больших объемов данных. OLAP-системы используются для поддержки сложных аналитических запросов, таких как анализ трендов, многомерный анализ данных, генерация отчетов и бизнес-аналитика. В отличие от OLTP, OLAP-системы оптимизированы для чтения данных и выполнения сложных запросов.

**Основные характеристики OLAP:**

OLAP-системы позволяют пользователям анализировать данные по различным измерениям (например, по времени, географии, продукту и т.д.).

Данные часто хранятся в денормализованном виде для ускорения выполнения сложных запросов.

OLAP-системы предназначены для выполнения сложных аналитических операций.

Пример: Руководитель компании использует OLAP-систему для анализа продаж по регионам за последние пять лет, чтобы выявить тенденции и принять стратегические решения.

Подводя итоги, можно сказать, что OLTP подходит для постоянной вставки данных, но на выборку будет работать долго. OLAP, наоборот, вставляет данные медленно, а считывает их моментально.

## Что такое таблица и из каких элементов она состоит?

Основная единица данных в базах данных - это таблица. И все запросы пишутся чаще всего к таблицам, а не к базам данных :)

Таблица в контексте баз данных — это основная структура, используемая для хранения данных. 

Таблица организована в виде строк и столбцов, где каждая строка представляет собой запись **(или экземпляр данных)**, а каждый столбец представляет собой поле **(или атрибут)** с определенным типом данных.

**Атрибуты - название столбца.**

**Строки (кортежи): Строки представляют собой записи в таблице, каждая из которых содержит значения для всех столбцов. В каждой строке хранится информация о конкретном объекте или событии.**

## ACID

**Транзакции** в контексте баз данных — это набор операций, выполняемых как единое целое. 

Транзакция гарантирует, что все операции в её составе будут выполнены полностью и корректно или не будут выполнены вовсе. 

Транзакции обеспечивают целостность данных и помогают избежать ситуаций, когда данные остаются в непоследовательном состоянии из-за сбоев или ошибок.

![image](https://github.com/user-attachments/assets/14ad37ec-b8b2-49c6-96d5-5cc02bb1fb06)

---------------------------------------------------------

Представим себе ситуацию, когда переводите деньги с одного банковского счета на другой. Эта операция может быть представлена как транзакция, состоящая из следующих шагов:

- Уменьшение суммы на одном счете.

 - Увеличение суммы на другом счете.

Если один из этих шагов не удастся (например, из-за технической ошибки), вся транзакция должна быть отменена, чтобы не произошло некорректное изменение баланса на счетах. 

---------------------------------------------------------

**Что делать, если база данных не поддерживает транзакции?**

Если у БД нет транзакций, то мы ее и выбирать не будем, но это не так. Транзакции не являются чем-то важным и супер необходимым.

Если транзакции "из коробки" не доступны, можно либо:

- отслеживать состояние базы данных вручную

- использовать сторонние инструменты для управления транзакциями (например Kafka)

---------------------------------------------------------

**Какие БД поддерживают транзакции?**

MySQL: Поддержка транзакций доступна в таблицах, использующих механизм хранения InnoDB.

PostgreSQL: Полная поддержка транзакций, включая сложные транзакции и вложенные транзакции.

MongoDB: Поддержка транзакций на уровне нескольких документов начиная с версии 4.0. 

И многие другие.

Транзакция - это вставка данных в таблицу, которая всегда должна закончиться либо успехом, либо неудачей, но без изменения данных в БД.

---------------------------------------------------------

**Какие еще свойства должна соблюдать транзакция?**

**ACID** — это акроним, описывающий четыре ключевых свойства транзакций в системах управления базами данных (СУБД). 

Эти свойства обеспечивают надёжность транзакций и целостность данных в базе данных, даже в случае сбоев, ошибок или других непредвиденных ситуаций. 

Вот они слева направо - Атомарность (Atomicity), Согласованность (Consistency), Изолированность (Isolation), Долговечность (Durability).

**1. Атомарность (Atomicity)**

Атомарность гарантирует, что все операции в транзакции будут выполнены полностью или не будут выполнены вовсе. 

Если какая-либо часть транзакции не удается, все изменения отменяются, и база данных возвращается в исходное состояние.

Отправляете деньги с одного банковского счёта на другой. Транзакция включает два шага:

Списать деньги с одного счёта.

Зачислить деньги на другой счёт.

Если первый шаг выполнен успешно, но второй шаг не удался из-за сбоя, деньги не должны исчезнуть. 

Атомарность гарантирует, что либо оба шага будут выполнены (деньги будут переведены), либо ни один из них (деньги останутся на исходном счёте).

Зачем это нужно? Атомарность защищает от частично выполненных транзакций, которые могут привести к некорректному состоянию данных.

**2. Согласованность (Consistency)**

Согласованность гарантирует, что после завершения транзакции база данных остаётся в согласованном состоянии. Это значит, что все правила, ограничения и целостность данных будут соблюдены.

Допустим, у есть правило в базе данных, что сумма всех денег на счетах не может изменяться. Если вы переводите деньги с одного счёта на другой, общая сумма должна остаться неизменной.

Согласованность гарантирует, что транзакция не нарушит это правило: сумма на одном счёте уменьшится, а на другом увеличится ровно на ту же сумму.

Зачем это нужно? Согласованность обеспечивает, что транзакции не приведут к нарушению целостности и правил базы данных, что важно для корректного функционирования системы.

**3. Изолированность (Isolation)**

Изолированность гарантирует, что параллельно выполняемые транзакции не будут влиять друг на друга. Каждая транзакция выполняется так, как будто она единственная в системе.

Два человека одновременно пытаются купить последний билет на концерт. Без изолированности могло бы произойти, что оба видят доступный билет, оба пытаются его купить, и система продаст один билет дважды.

Изолированность гарантирует, что одна из транзакций будет завершена первой (человек успешно купит билет), а вторая транзакция либо увидит, что билетов больше нет, либо будет обработана позже.

Зачем это нужно? Изолированность предотвращает конфликты и ошибки, которые могут возникнуть при параллельной работе с одними и теми же данными.

**4. Долговечность (Durability)**

Долговечность гарантирует, что после успешного завершения транзакции её результаты сохранятся в базе данных и не будут потеряны, даже в случае сбоя системы.

После успешной оплаты (транзакция завершена) ваша покупка зафиксирована, и подтверждение получено.

То есть, после завершения оплаты, система зафиксирует вашу покупку, и вы получите подтверждение об успешной транзакции.

Зачем это нужно? Долговечность обеспечивает сохранение результатов транзакции, что особенно важно для критически важных операций, таких как банковские переводы или покупки.

**Пример**

Так ли важны эти свойства для транзакций? Неужели никаким из них нельзя пренебречь? Ответ будет очень простой - представьте себя покупателем. И тут куча ситуаций, которые могут возникнуть, а самое главное, что у каждого из этих случаев будут последствия.

Вы видите, что ноутбук есть в наличии, и решаете его купить. Однако, поскольку не используется транзакция, другая покупка может одновременно снизить запасы на складе до нуля.

Деньги с вашего счёта успешно списываются, но между этим и обновлением запасов на складе происходит сбой.

Произошел сбой на сервере, и информация о том, что ноутбук был продан, не была обновлена на складе. В результате запас ноутбуков на складе остаётся прежним, хотя фактически ноутбук уже не доступен.

Последствия -  

Вы потеряли деньги, но заказ не был оформлен. В системе нет следов вашей покупки, и вы не получите ноутбук, хотя заплатили за него.

На сайте может отображаться, что ноутбук всё ещё доступен для покупки, хотя его уже нет на складе. Это может привести к множеству разочарованных клиентов, которые будут пытаться купить недоступный товар.

Без следов транзакции в системе может быть сложно доказать, что вы совершили покупку, и вернуть свои деньги.

## Ключи

**Ключи в реляционных базах данных** — это особые столбцы или комбинации столбцов в таблицах, которые служат для идентификации записей и определения связей между таблицами. 

Ключи играют важную роль в обеспечении целостности данных и организации отношений между таблицами в базе данных.

**2 ключевых момента:** 

- Ключи нужны для идентификации каждой строки в таблице. То есть, чтобы у каждой строки было свое уникальное значение. Например, у человека это серия и номер паспорта, у машин VIN номер.

- Ключи нужны для образования отношений между таблицами.

-------------------------------------------------------------

**Первичный ключ (Primary Key).**

Таблица 1: Employees (Сотрудники)

![image](https://github.com/user-attachments/assets/0b8d920a-8c4d-439c-9575-ccc7d58f7c37)

Таблица 2: Departments (Отделы)

![image](https://github.com/user-attachments/assets/8dbc4f63-3f03-4895-8b01-658c0b64600a)

*Таблица: Employees*

Описание: В таблице Employees столбец EmpID является первичным ключом, потому что он уникально идентифицирует каждого сотрудника. Значения в этом столбце уникальны и не могут быть пустыми.

Пример: EmpID = 1 относится к сотруднику по имени Alice.

*Таблица: Departments*

Описание: В таблице Departments столбец DeptID является первичным ключом, потому что он уникально идентифицирует каждый отдел.

Пример: DeptID = 2 относится к отделу Engineering.

**Внешний ключ (Foreign Key).**

Таблица: Employees

Описание: В таблице Employees столбец DeptID является внешним ключом, который ссылается на столбец DeptID в таблице Departments. Это означает, что каждый сотрудник связан с отделом через этот внешний ключ.

Пример: У сотрудника с EmpID = 1 (Alice) DeptID = 1, что в свою очередь является ссылкой на отдел HR в таблице Departments.

**Составной ключ (Composite Key)**

Ситуация: Допустим, у нас есть таблица EmployeeProjects (которая описывает проекты сотрудников), которая отслеживает, какие сотрудники работают над какими проектами. Для уникальной идентификации записи необходимо использовать комбинацию двух столбцов: EmpID и ProjectID.

*Таблица: EmployeeProjects*

![image](https://github.com/user-attachments/assets/b3546b7d-b438-4289-9391-60a3049ca9b9)

В этой таблице комбинация EmpID и ProjectID служит составным первичным ключом, что значит, что для каждого проекта сотрудник может быть указан только один раз. Уникально идентифицирует сочетание сотрудника и проекта, на котором он работает. Ни один отдельный столбец (EmpID или ProjectID) не может быть уникальным, но их комбинация является уникальной.

![image](https://github.com/user-attachments/assets/a4f93468-94f1-4220-87f3-da03c4a573e9)
