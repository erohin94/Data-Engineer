# **Установка**

Дока https://airflow.apache.org/docs/apache-airflow/stable/howto/docker-compose/index.html

Установить и запустить Airflow можно разными способами,но для удобства мы используем docker compose из официальной документации Airflow.

Для развертывания Apache Airflow с использованием docker compose, вам нужно выполнить несколько подготовительных шагов, включая настройку папок, скачивание и конфигурирование файла docker-compose.yaml, а также инициализацию и запуск Airflow. Так вкратце выглядит путь, который нам предстоит пройти. Начнем! В главе продемонстрирован запуск в Ubuntu, но все команды спарведливы и для других систем, в частности для Windows, но без sudo разумеется.

**Шаг 1: Подготовка структуры папок**

- Создайте  главную папку для вашего проекта `Airflow`. Например, `airflow_project`
- Внутри этой папки создайте три подпапки: `dags`, `logs`, и `plugins`

**Шаг 2:  Скачивание docker-compose.yaml**

Необходимо скачать файл `docker-compose.yaml` с официального сайта Apache Airflow по ссылке :
https://airflow.apache.org/docs/apache-airflow/2.9.2/docker-compose.yaml и поместить его в папку `airflow_project`.

Копируем весь текст из этой ссылки и вставлем в блокнот который создали в папке.
Меняем расширение у блокнота c txt на yaml. Получаем файл `docker-compose.yaml`

Должно получиться вот так:

![image](https://github.com/user-attachments/assets/294896ad-6630-41f3-97e5-e9f4b063ad84)

Теперь открываем этот файл и находим 62 строку. Меняем в ней значение параметра с 'true' на 'false' и нажимаем кнопку Сохранить:

![image](https://github.com/user-attachments/assets/1902507f-b1fc-465c-9405-a3e7358209f9)

Этот параметр отвечает за загрузку разных примеров DAG при запуске Airflow. Это несомненно полезно, но только когда видишь Airflow не в первый раз. Вы всегда сможете включить этот параметр и посмотреть на те примеры, которые сами создатели Airflow. Кстати, обратите внимание на структуру и объем этого docker-compose файла - это хороший пример к предыдущей теме)

**Шаг 3: Инициализация Airflow**
- Открываем Docker Desctop
- Заходим в папку  `airflow_project` кликаем правой кнопкой мыши и выбираем пункт меню Открыть в терминале и в открывшемся терминале выполняем команду:

Linux:

`sudo docker-compose up airflow-init`

Windows (выполняем в PowerShell либо Git Bash):

`docker-compose up airflow-init`

Это необходимо для инициализации, а так же, как пишут в официальной документации, "чтобы запустить миграцию базы данных и создать первую учетную запись пользователя".

- Дождитесь окончания процесса инициализации, который настроит служебную базу данных и создаст необходимые таблицы.(Кстати в качестве служебных БД в Airflow используется PostgreSQL и не только - это будет видно в процессе выполнения команды).

Успешное завершение выглядит так:

![image](https://github.com/user-attachments/assets/2a579f1d-aa96-4669-94cb-3c5fcedf7749)

**Шаг 4: Запуск Airflow**

- После успешной инициализации запустите Airflow выполнив в терминале команду:

Linux:

`sudo docker-compose up -d `

Windows:

`docker-compose up -d`

Подождите, пока все сервисы будут запущены.

Чтобы увидеть интерфейс Airflow откройте браузер и перейдите по адресу http://127.0.0.1:8080/

Если все прошло по плану, то появится окно для ввода имени пользователя и пароля. Вводим в оба окошка airflow и подтверждаем. Перед нами открывается основное окно инструмента:

![image](https://github.com/user-attachments/assets/aa337c6c-7bbe-4483-89f6-bf1bf83ef6d0)

На этом установка закончена - переходим к использованию!

Дополнительно, для тех кто все же установил Docker Desktop, обращаю внимание на то, как выглядит запущенный compose в Docker Desktop. Можно увидеть все запущенные контейнеры, описанные в файле:

![image](https://github.com/user-attachments/assets/76328688-c846-48b1-ab0d-e19b9b8da55f)




