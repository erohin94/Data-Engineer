# Описание логики проекта

В этом репозитории немного изменю проект который делал [тут](https://github.com/erohin94/Data-Engineer/tree/main/Airflow/airflow_project_ny_taxi) поэтому установку всех зависимостей, 
настройку подключений и тд беру из первого проекта. 

Здесь проект будет немного модифицирован: 

```PythonOperator``` будет загружать файл с веб-сайта и укладывать в S3 в сжатом виде (буду использовать gzip).

Так как ```PythonOperator``` принимает объект типа callable, который будет выполнен, поэтому загрузку файла вынесу в отдельную функцию ```functions.py```. 

В коде пропишу путь до S3 объекта, куда будет сохранён загружаемый файл с данными. 

Далее с веб-ресурса файл сохраняется во временный файл и загружается на S3 с использованием gzip=True. Функция возвращает путь до S3 объекта, которым воспользуется следующий оператор.

Далее ```PythonOperator``` оператор скачивает файл, загруженный предыдущим оператором, и трансформирует его в формат Parquet, сохраняя результат в S3.

**Про формат Parquet**

Хранить данные открытым текстом дорого и неэффективно. 

Дорого потому что объём больше (а в S3 плата взымается в том числе за размер файла).

Неэффективно потому что для того, чтобы найти в нём нужную информацию, его надо прочитать целиком, так же увеличивается время передачи по сети. 

Поэтому существует множество эффективных способов хранить и читать данные.

Apache Parquet — это бинарный формат колоночного хранения данных в сжатом виде (есть ряд поддерживаемых алгоритмов сжатия, включая lzo, gzip, snappy и т.д.). 

Идеально подходит для представления табличных данных. 

Parquet-файл можно представить в виде базы данных с одной таблицей. 

Преимущество этого формата в эффективной компрессии файла за счёт колоночного хранения (строка по сути содержит все данные одной конкретной колонки), а также в эффективном чтении. 

В аналитических запросах редко присутствуют выборки всех колонок сразу, обычно читают лишь часть. Если не вдаваться в детали реализации Parquet, а попробовать объяснить представление данных внутри максимально просто, 
то Parquet выглядит как небольшая файловая система, где значения каждой колонки лежат в отдельных файлах, а также присутствует дополнительный файл с метаданными, где хранится информация о типах колонок и их расположении. 
То есть чтобы получить значения заданных колонок нужно прочитать только файлы, содержащие данные этих колонок (а не всё целиком). Подробную информацию можно найти на официальном сайте Apache Parquet.
